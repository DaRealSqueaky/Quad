const pg = require('pg');
const config = require('config');

class Database {
    #pool;
    
    async init() {
        this.#pool = new pg.Pool(config.get("database"));
        let client = await this.get()
        try {
            await client.query("CREATE TABLE IF NOT EXISTS userLocales(id TEXT PRIMARY KEY, locale TEXT DEFAULT 'en')");
            await client.query("CREATE TABLE IF NOT EXISTS guildLocales(id TEXT PRIMARY KEY, locale TEXT DEFAULT 'en')");
            await client.query("CREATE TABLE IF NOT EXISTS guildPrefix(id TEXT PRIMARY KEY, prefix TEXT)");
            await client.query("CREATE TABLE IF NOT EXISTS guildLogs(id TEXT PRIMARY KEY, alerts TEXT, logs TEXT)");
        } finally {
            client.release(); 
        }
    }
    
    async get() {
        return await this.#pool.connect();
    }
    
    getPool() {
        return this.#pool;
    }
}

let d = new Database();
module.exports = d;