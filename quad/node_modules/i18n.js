const fs = require('fs');
const i18next = require('i18next');
let i18nextbackend = require('i18next-node-fs-backend');

let availableTranslations = fs.readdirSync("translations");
i18next.use(i18nextbackend).init({
    fallbackLng: false,
    nsSeparator: false,
    keySeparator: false,
    preload: availableTranslations,
    ns: ["translation"],
    returnEmptyString: false,
    backend: {
        loadPath: "./translations/{{lng}}/{{ns}}.json"
    }
});

function trForDescriptor(translator) {
    //TODO: Check for user IDs
    
    if (availableTranslations.includes(translator)) {
        return {
            t: i18next.getFixedT(translator, "translation")
        };
    }
    
    return {
        t: i18next.getFixedT("en", "translation")
    };
}

module.exports = trForDescriptor;
module.exports.t = trForDescriptor(process.env["LANG"]).t